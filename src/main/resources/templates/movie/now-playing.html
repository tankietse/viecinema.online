<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{_layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vie Cinema: Hệ Thống Rạp Chiếu Phim Hại Điện</title>
    <link rel="icon" type="image/svg" th:href="@{/static/img/Vie.svg}" />
    <link rel="stylesheet" th:href="@{/static/css/home.css}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.0/lazysizes.min.js" async></script>
    <!-- Include any specific meta tags or CSS/JS files for this page -->
</head>
<body>
<!-- Include layout -->
<section layout:fragment="content">
    <div class="container custom-scrollbar">
        <div class="top-content">
            <div>
                <ul class="task-list">
                    <li id="new-movie"  th:th:data-url="@{/home}">Phim</li>
                    <li id="now-playing" class="page-active" th:th:data-url="@{/now-playing}">Đang chiếu</li>
                    <li id="coming-soon" th:data-url="@{/coming-soon}">Sắp chiếu</li>
                    <li id="IMAX" >IMAX</li>
                </ul>
            </div>
        </div>
        <div class="middle-content">
            <div th:each="row : ${#numbers.sequence(0, nowPlayingMovies.size() / 4)}">
                <div class="card-row">
                    <div th:each="movie : ${nowPlayingMovies.subList(row * 4, T(java.lang.Math).min((row + 1) * 4, nowPlayingMovies.size()))}" class="movie-cards">
                        <div class="card-item">
                            <img th:data-src="'https://image.tmdb.org/t/p/w500' + ${movie.posterPath}" alt="" th:src="@{/static/img/placeholder.png}" class="lazyload">
                        </div>
                        <span class="movie-title" th:text="${movie.title}"></span>
                        <div class="overlay">
                            <div class="card-buttons">
                                <a href="#" class="buy-ticket">Mua vé</a>
                                <a href="#" class="watch-trailer" th:data-video-id="${movie.videoId}">Xem trailer</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Modal -->
                <div id="videoModal" class="modal">
                    <div class="modal-content">
                        <span class="close video-close">&times;</span>
                        <iframe id="videoFrame" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        <div id="videoError" style="color: rgb(255, 123, 0); display: none;">Không thể phát video. Vui lòng thử lại sau.</div>
                    </div>
                </div>

                <div id="consentModal" class="cookie-law-info-bar">
                    <div class="cookies-content">
                        <div>
                            <span class="close consent-close">&times;</span>
                            <h4>Cookies consent for VieCinema.com</h4>
                            <p>We use cookies on our website to help us provide you with the best, most relevant experience, for analytics and to improve functionality. We may share your information with advertising and analytics partners. You may disable cookies through your browser, but this will limit the functions of the website. Learn more about privacy on our website.</p>
                            <p>By clicking accept, you consent to the use of all cookies.</p>
                        </div>
                        <div class="cookies-buttons">
                            <button id="declineCookies">Decline</button>
                            <button id="acceptCookies">Accept</button>
                        </div>
                    </div>
                </div>
            </div>
            <button id="btn-more">Xem thêm</button>
            <hr>
        </div>

    <div id="introduction">
        <div>
            <h2>PHIM ĐANG CHIẾU TẠI VIECINEMA</h2>
            <p>
                Chào mừng bạn đến với <strong>VieCinema.online</strong>! Tại đây, chúng tôi luôn cập nhật nhanh chóng và đầy đủ nhất các <strong>phim đang chiếu</strong> hot nhất, được yêu thích nhất. Bạn có thể dễ dàng tìm thấy những bộ phim bom tấn, những bộ phim tình cảm lãng mạn, hay những bộ phim hành động gay cấn.
            </p>
            <p>
                Hãy vào tab <strong>Phim đang chiếu</strong> để khám phá ngay danh sách các bộ phim nổi bật. Bạn sẽ tìm thấy thông tin chi tiết về từng bộ phim, bao gồm trailer, lịch chiếu, và những đánh giá từ khán giả. Với hệ thống <strong>rạp chiếu phim</strong> hiện đại của <strong>Vie Cinema</strong>, trải nghiệm xem phim của bạn sẽ tuyệt vời hơn bao giờ hết.
            </p>
            <p>
                Đặt vé ngay hôm nay để không bỏ lỡ bất kỳ khoảnh khắc nào của những bộ phim đặc sắc. Chỉ với vài thao tác đơn giản, bạn có thể chọn mua vé theo phim, theo rạp, hoặc theo ngày. Sau khi hoàn tất đặt vé, bạn sẽ nhận được tin nhắn và email xác nhận <strong>Đặt vé thành công</strong> từ <strong>Vie Cinema</strong>. Hãy sử dụng tin nhắn hoặc mã QR để nhận vé tại rạp mà không cần phải chờ đợi lâu.
            </p>
            <p>
                Nếu bạn đang tìm kiếm một trải nghiệm xem phim hoàn hảo, đừng quên sử dụng box <strong>Mua Vé Nhanh</strong> ngay từ <strong>Trang Chủ</strong>. Chỉ trong một phút, bạn sẽ nhận được phản hồi đặt vé ngay lập tức từ chúng tôi. Tham gia ngay và trải nghiệm những phút giây thư giãn tuyệt vời cùng <strong>Vie Cinema</strong>!
            </p>
        </div>
    </div>
    </div>
</section>
<script>
    let list = document.querySelector(".slider .list");
    let items = document.querySelectorAll(".slider .list .item");
    let dots = document.querySelectorAll(".slider .dots li");
    let prev = document.getElementById('prev');
    let next = document.getElementById("next");

    let active = 1;
    let lengthItem = items.length - 1;

    next.onclick = function () {
      if (active + 1 > lengthItem) {
        active = 0;
      } else {
        active += 1;
      }
      reloadSlider();
    };

    prev.onclick = function () {
      if (active - 1 <0) {
        active = lengthItem;
      } else {
        active -= 1;
      }
      reloadSlider();
    };

    let refreshSlider = setInterval(() => {
      next.click();
    }, 5000);

    function reloadSlider() {
      let checkLeft = items[active].offsetLeft;
      list.style.left = -checkLeft + 'px';

      let lastActiveDot = document.querySelector('.slider .dots li.active');
      if (lastActiveDot) {
        lastActiveDot.classList.remove('active');
      }
      dots[active].classList.add('active');
      clearInterval(refreshSlider);
      refreshSlider = setInterval(() => {
        next.click();
      }, 5000);
    }

    dots.forEach((li, key) => {
      li.addEventListener('click', function () {
        active = key;
        reloadSlider();
      });
    });

    reloadSlider(); // Ensure initial state is correct
</script>
<script>
    // Get modal elements
    var modal = document.getElementById("videoModal");
    var videoFrame = document.getElementById("videoFrame");
    var span = document.getElementsByClassName("close")[0];

    // Add event listeners to "Xem trailer" buttons
    var trailerButtons = document.querySelectorAll(".watch-trailer");
    trailerButtons.forEach(function(button) {
      button.addEventListener("click", function(event) {
        event.preventDefault();
        var videoId = this.getAttribute("data-video-id");
        var videoUrl = "https://www.youtube.com/embed/" + videoId + "?autoplay=1";

        // Reset iframe src
        videoFrame.src = "";

        // Set iframe src to video URL and display modal
        videoFrame.src = videoUrl;
        modal.style.display = "block";
      });
    });

    // Close the modal
    span.onclick = function() {
      modal.style.display = "none";
      videoFrame.src = "";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
        videoFrame.src = "";
      }
    }

</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var videoModal = document.getElementById('videoModal');
        var videoFrame = document.getElementById('videoFrame');
        var videoClose = document.querySelector('.video-close');

        var consentModal = document.getElementById('consentModal');
        var consentClose = document.querySelector('.consent-close');
        var acceptCookies = document.getElementById('acceptCookies');
        var declineCookies = document.getElementById('declineCookies');

        // Function to show video modal
        function showModal(videoUrl) {
            videoFrame.src = videoUrl;
            videoModal.style.display = 'flex';
        }

        // Function to close video modal
        videoClose.onclick = function() {
            videoModal.style.display = 'none';
            videoFrame.src = '';
        }

        // Function to close consent modal
        consentClose.onclick = function() {
            consentModal.style.display = 'none';
        }

        // Check if consent was already given
        if (!localStorage.getItem('cookiesAccepted')) {
            consentModal.style.display = 'flex';
        }

        // Handle cookie consent actions
        acceptCookies.onclick = function() {
            localStorage.setItem('cookiesAccepted', 'true');
            consentModal.style.display = 'none';
        }

        declineCookies.onclick = function() {
            consentModal.style.display = 'none';
        }

        // Close video modal when clicking outside the modal
        window.onclick = function(event) {
            if (event.target == videoModal) {
                videoModal.style.display = 'none';
                videoFrame.src = '';
            }
            if (event.target == consentModal) {
                consentModal.style.display = 'none';
            }
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    const taskList = document.querySelectorAll('.task-list li');

    taskList.forEach(function (item) {
      item.addEventListener('click', function () {
        // Remove active class from all items
        taskList.forEach(function (li) {
          li.classList.remove('page-active');
        });
        // Add active class to the clicked item
        this.classList.add('page-active');

        // Navigate to the corresponding page
        const url = this.getAttribute('data-url');
        if (url) {
          window.location.href = url;
        }
      });
    });
  });
</script>
</body>
</html>
